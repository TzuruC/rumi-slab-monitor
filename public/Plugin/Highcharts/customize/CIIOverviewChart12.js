let CIIOverviewChart12AllData = [
    { x: 4.648, y: 2.013, custom: { timestamp: '2024-01-01 00:00' } },
    { x: 4.583, y: 1.354, custom: { timestamp: '2024-01-01 00:07' } },
    { x: -2.548, y: 1.066, custom: { timestamp: '2024-01-01 00:14' } },
    { x: -2.321, y: -0.733, custom: { timestamp: '2024-01-01 00:21' } },
    { x: 3.684, y: 1.013, custom: { timestamp: '2024-01-01 00:28' } },
    { x: 2.888, y: -0.539, custom: { timestamp: '2024-01-01 00:35' } },
    { x: 2.358, y: 1.496, custom: { timestamp: '2024-01-01 00:42' } },
    { x: -0.535, y: 1.718, custom: { timestamp: '2024-01-01 00:49' } },
    { x: 1.848, y: -0.462, custom: { timestamp: '2024-01-01 00:56' } },
    { x: 1.854, y: 2.748, custom: { timestamp: '2024-01-01 01:03' } },
    { x: 1.65, y: 3.253, custom: { timestamp: '2024-01-01 01:10' } },
    { x: -1.733, y: 2.058, custom: { timestamp: '2024-01-01 01:17' } },
    { x: 0.445, y: 2.586, custom: { timestamp: '2024-01-01 01:24' } },
    { x: 0.148, y: 1.168, custom: { timestamp: '2024-01-01 01:31' } },
    { x: 2.784, y: 1.399, custom: { timestamp: '2024-01-01 01:38' } },
    { x: 4.959, y: 4.581, custom: { timestamp: '2024-01-01 01:45' } },
    { x: 4.595, y: 3.141, custom: { timestamp: '2024-01-01 01:52' } },
    { x: 1.353, y: 2.451, custom: { timestamp: '2024-01-01 01:59' } },
    { x: 0.559, y: 2.402, custom: { timestamp: '2024-01-01 02:06' } },
    { x: -0.854, y: 0.831, custom: { timestamp: '2024-01-01 02:13' } },
    { x: -2.713, y: 0.781, custom: { timestamp: '2024-01-01 02:20' } },
    { x: -2.78, y: -1.127, custom: { timestamp: '2024-01-01 02:27' } },
    { x: 0.719, y: 0.905, custom: { timestamp: '2024-01-01 02:34' } },
    { x: -0.452, y: 3.767, custom: { timestamp: '2024-01-01 02:41' } },
    { x: 0.04, y: 2.959, custom: { timestamp: '2024-01-01 02:48' } },
    { x: 4.134, y: 1.68, custom: { timestamp: '2024-01-01 02:55' } },
    { x: 1.206, y: 1.339, custom: { timestamp: '2024-01-01 03:02' } },
    { x: 1.484, y: 1.781, custom: { timestamp: '2024-01-01 03:09' } },
    { x: -1.111, y: 1.82, custom: { timestamp: '2024-01-01 03:16' } },
    { x: -2.809, y: -0.987, custom: { timestamp: '2024-01-01 03:23' } },
    { x: -0.399, y: 2.752, custom: { timestamp: '2024-01-01 03:30' } },
    { x: -1.906, y: 0.949, custom: { timestamp: '2024-01-01 03:37' } },
    { x: 1.082, y: 1.394, custom: { timestamp: '2024-01-01 03:44' } },
    { x: 4.989, y: 4.606, custom: { timestamp: '2024-01-01 03:51' } },
    { x: 2.396, y: 0.42, custom: { timestamp: '2024-01-01 03:58' } },
    { x: -1.545, y: 1.738, custom: { timestamp: '2024-01-01 04:05' } },
    { x: 4.149, y: 2.807, custom: { timestamp: '2024-01-01 04:12' } },
    { x: 3.374, y: 1.321, custom: { timestamp: '2024-01-01 04:19' } },
    { x: 2.875, y: 0.939, custom: { timestamp: '2024-01-01 04:26' } },
    { x: 4.253, y: 3.535, custom: { timestamp: '2024-01-01 04:33' } },
    { x: 3.103, y: -0.248, custom: { timestamp: '2024-01-01 04:40' } },
    { x: 3.318, y: 2.644, custom: { timestamp: '2024-01-01 04:47' } },
    { x: -0.17, y: 1.078, custom: { timestamp: '2024-01-01 04:54' } },
    { x: 4.848, y: 3.636, custom: { timestamp: '2024-01-01 05:01' } },
    { x: 4.695, y: 2.203, custom: { timestamp: '2024-01-01 05:08' } },
    { x: -1.711, y: 1.126, custom: { timestamp: '2024-01-01 05:15' } },
    { x: 3.032, y: -0.522, custom: { timestamp: '2024-01-01 05:22' } },
    { x: 2.721, y: 0.315, custom: { timestamp: '2024-01-01 05:29' } },
    { x: 0.691, y: 2.694, custom: { timestamp: '2024-01-01 05:36' } },
    { x: 1.243, y: 2.708, custom: { timestamp: '2024-01-01 05:43' } },
    { x: 0.92, y: 2.536, custom: { timestamp: '2024-01-01 05:50' } },
    { x: 4.399, y: 2.117, custom: { timestamp: '2024-01-01 05:57' } },
    { x: 1.007, y: 2.395, custom: { timestamp: '2024-01-01 06:04' } },
    { x: 3.652, y: 1.265, custom: { timestamp: '2024-01-01 06:11' } },
    { x: -0.169, y: 2.138, custom: { timestamp: '2024-01-01 06:18' } },
    { x: 4.063, y: 1.791, custom: { timestamp: '2024-01-01 06:25' } },
    { x: 4.198, y: 1.705, custom: { timestamp: '2024-01-01 06:32' } },
    { x: 0.688, y: 3.712, custom: { timestamp: '2024-01-01 06:39' } },
    { x: 1.542, y: 1.832, custom: { timestamp: '2024-01-01 06:46' } },
    { x: 4.363, y: 1.436, custom: { timestamp: '2024-01-01 06:53' } },
    { x: 2.79, y: 0.954, custom: { timestamp: '2024-01-01 07:00' } },
    { x: 0.893, y: 1.342, custom: { timestamp: '2024-01-01 07:07' } },
    { x: -1.226, y: 3.519, custom: { timestamp: '2024-01-01 07:14' } },
    { x: -0.403, y: 2.466, custom: { timestamp: '2024-01-01 07:21' } },
    { x: 2.597, y: -0.78, custom: { timestamp: '2024-01-01 07:28' } },
    { x: -1.671, y: 0.765, custom: { timestamp: '2024-01-01 07:35' } },
    { x: 4.264, y: 2.736, custom: { timestamp: '2024-01-01 07:42' } },
    { x: -0.855, y: 3.988, custom: { timestamp: '2024-01-01 07:49' } },
    { x: 4.291, y: 2.888, custom: { timestamp: '2024-01-01 07:56' } },
    { x: -0.523, y: 2.865, custom: { timestamp: '2024-01-01 08:03' } },
    { x: 4.659, y: 3.201, custom: { timestamp: '2024-01-01 08:10' } },
    { x: 2.65, y: 2.046, custom: { timestamp: '2024-01-01 08:17' } },
    { x: 1.034, y: 0.55, custom: { timestamp: '2024-01-01 08:24' } },
    { x: 1.142, y: 1.522, custom: { timestamp: '2024-01-01 08:31' } },
    { x: 2.211, y: 1.456, custom: { timestamp: '2024-01-01 08:38' } },
    { x: 1.704, y: 2.286, custom: { timestamp: '2024-01-01 08:45' } },
    { x: -0.505, y: 3.947, custom: { timestamp: '2024-01-01 08:52' } },
    { x: -1.337, y: 1.281, custom: { timestamp: '2024-01-01 08:59' } },
    { x: 1.095, y: 1.113, custom: { timestamp: '2024-01-01 09:06' } },
    { x: 4.473, y: 1.199, custom: { timestamp: '2024-01-01 09:13' } },
    { x: 1.986, y: 2.308, custom: { timestamp: '2024-01-01 09:20' } },
    { x: -2.397, y: 1.838, custom: { timestamp: '2024-01-01 09:27' } },
    { x: 3.563, y: 1.649, custom: { timestamp: '2024-01-01 09:34' } },
    { x: 2.808, y: 1.676, custom: { timestamp: '2024-01-01 09:41' } },
    { x: 4.261, y: 0.631, custom: { timestamp: '2024-01-01 09:48' } },
    { x: -1.469, y: 2.266, custom: { timestamp: '2024-01-01 09:55' } },
    { x: 2.958, y: 0.901, custom: { timestamp: '2024-01-01 10:02' } },
    { x: -2.53, y: 0.325, custom: { timestamp: '2024-01-01 10:09' } },
    { x: 2.223, y: 1.89, custom: { timestamp: '2024-01-01 10:16' } },
    { x: -0.815, y: 2.656, custom: { timestamp: '2024-01-01 10:23' } },
    { x: -1.187, y: 2.236, custom: { timestamp: '2024-01-01 10:30' } },
    { x: 4.004, y: 1.712, custom: { timestamp: '2024-01-01 10:37' } },
    { x: -2.15, y: -0.832, custom: { timestamp: '2024-01-01 10:44' } },
    { x: 1.179, y: 2.359, custom: { timestamp: '2024-01-01 10:51' } },
    { x: 3.832, y: 2.834, custom: { timestamp: '2024-01-01 10:58' } },
    { x: -1.041, y: 3.408, custom: { timestamp: '2024-01-01 11:05' } },
    { x: -1.316, y: 1.606, custom: { timestamp: '2024-01-01 11:12' } },
    { x: 4.045, y: 1.696, custom: { timestamp: '2024-01-01 11:19' } },
    { x: 0.383, y: 3.496, custom: { timestamp: '2024-01-01 11:26' } },
    { x: 2.736, y: 0.766, custom: { timestamp: '2024-01-01 11:33' } },
];
// 散點圖資料 - 燃油消耗量(mt/hr)(藍色)
let CIIOverviewChart12AllDataGetArray = CIIOverviewChart12AllData.map((data) => [data.x, data.y]);
let CIIOverviewChart12_DotColor = '#00AAFF';
function generateChart(CIIOverviewChart12AllData) {
    Highcharts.chart('CIIOverviewChart12', {
        chart: {
            backgroundColor: '#292929',
        },
        title: null,
        xAxis: {
            title: {
                text: '航速 (knots)',
                style: {
                    color: '#FFFFFF', // Y軸標題顏色
                },
            },
            minPadding: 0.1,
            maxPadding: 0.1,
            lineColor: '#FFFFFF',
        },
        yAxis: {
            title: {
                text: '燃油消耗量 (mt/h)',
                style: {
                    color: '#FFFFFF', // Y軸標題顏色
                },
            },
            gridLineColor: '#FFFFFF', // Y軸延伸線顏色
            lineWidth: 1,
            lineColor: '#FFFFFF', // Y軸顏色
            tickColor: '#FFFFFF', // Y軸刻度顏色
            labels: {
                style: {
                    color: '#FFFFFF', // Y軸標籤顏色
                },
            },
        },
        legend: {
            enabled: false,
        },
        // tooltip: {
        //     useHTML: true,
        //     formatter: function () {
        //         return `<span style="color:${this.color}">\u25CF</span> <b>${this.point.custom.timestamp}</b><br/>
        //                主機消耗：${this.x} knots<br/>
        //                航速：${this.y} mt/h`;
        //     },
        // },

        tooltip: {
            useHTML: true,
            formatter: function () {
                console.log(this.point.timestamp);
                return `<span style="padding:0;font-size:0.875rem;line-height:1.25rem; color:#fff">
                <span style="display:inline-block;color:${CIIOverviewChart12_DotColor};font-size:1.25rem;">●</span>
                <span style="margin-bottom:8px;display:inline-block;font-size:1rem;">${
                    this.point.custom?.timestamp || 'N/A'
                }</span><br>
                主機消耗：${this.y} knots<br>
                航速：${this.x} mt/h
                </span>`;
            },
        },
        series: [
            {
                type: 'scatter',
                name: '主機消耗',
                data: CIIOverviewChart12AllData,
                marker: {
                    radius: 4,
                },
                color: CIIOverviewChart12_DotColor,
            },
            {
                type: 'spline',
                name: '二次回歸線',
                data: generateLineData(linearRegression(CIIOverviewChart12AllDataGetArray, 2), -3, 5, 10),
                marker: {
                    enabled: false,
                },
                states: {
                    hover: {
                        lineWidth: 0,
                    },
                },
                enableMouseTracking: false,
                color: '#FFE100',
            },
        ],
    });
}

// Matrix calculations to calculate the variables for least square regression.
// Utilizing the mathjs library for matrix operations

function linearRegression(CIIOverviewChart12AllDataGetArray, nDegrees) {
    // Split the dataset into x and y
    const x = CIIOverviewChart12AllDataGetArray.map((val) => val[0]);
    const y = CIIOverviewChart12AllDataGetArray.map((val) => val[1]);
    const X = [];

    // Create n-dimensional X-matrix
    for (let i = 0; i <= nDegrees; i++) {
        X.push(x.map((num) => num ** i));
    }

    // Calculate least square variables
    const Xt = window.math.transpose(X);
    const XtX = window.math.multiply(X, Xt);
    const invXtX = window.math.inv(XtX);
    const Xty = window.math.multiply(y, Xt);
    const b = window.math.multiply(Xty, invXtX);

    // return variables [a, b, c, ...], to be applied as a + b*x + c*x^2 + ...
    return b;
}

function generateLineData(constants, start, end, resolution) {
    const outData = [];
    for (let x = start; x <= end; x += 1 / resolution) {
        let y = 0;
        for (let j = 0; j < constants.length; j++) {
            y += constants[j] * x ** j;
        }
        outData.push([x, y]);
    }
    return outData;
}

generateChart(CIIOverviewChart12AllData);
